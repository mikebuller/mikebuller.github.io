<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Bonville G.C. Invitational</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles-part2.css">
    <link rel="stylesheet" href="styles-part3.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <!-- Canvas Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, doc, getDoc, getDocs, setDoc, updateDoc, query, where, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        
        // Encrypted Firebase configuration (AES-256-GCM with PBKDF2 key derivation, 100k iterations)
        const ENCRYPTED_CONFIG = "uKM6aVSB3RZSzPonDOS99pGpViMTWGDeVcpAhaN129HBEeUmEosPOI6vk3sMgpKmLSrWelZalynmgqJOfhFgyz3v+7I6y76nMOVCItP4VTep2pDzi9MZWynRqjo4nZPBa0DVzdWGJ2Gm+JAZ2lV8wNS6so0Qi4jAG0tebqoD/uIMxblgw3Kk5JfeDsgSiaBaG4PzHc7jO7oZNQ09+gZSYNxjPQGMydyAs2WNEf1Ix7slo4ERoYkIf5vSgdKCeJ9+fQh68wf8P6oYfu5sh86VT03QrCvBB9YB5F+/fodm40QaN3rlGDMc5GxPAzarcrM3sSKyxE0IHUIRK/HmP8kjB5n9cLT6YW2BwDLa6xb/mZmjpQGtls/0rFv6K2OndnMtZNX4dOKWHty3QqKi7GKJGoRE78beu5SDjKPPpN1HygQTfm7NSD8eXVCR1zjPXHDhU9I=";
        
        // Decrypt Firebase config using password with PBKDF2 + AES-GCM
        async function decryptConfig(password) {
            try {
                // Decode base64
                const combined = Uint8Array.from(atob(ENCRYPTED_CONFIG), c => c.charCodeAt(0));
                
                // Extract: salt (16 bytes) + iv (12 bytes) + authTag (16 bytes) + encrypted data
                const salt = combined.slice(0, 16);
                const iv = combined.slice(16, 28);
                const authTag = combined.slice(28, 44);
                const encrypted = combined.slice(44);
                
                // Combine encrypted data with auth tag for Web Crypto API
                const encryptedWithTag = new Uint8Array(encrypted.length + authTag.length);
                encryptedWithTag.set(encrypted);
                encryptedWithTag.set(authTag, encrypted.length);
                
                // Derive key using PBKDF2 (100,000 iterations, SHA-256)
                const encoder = new TextEncoder();
                const keyMaterial = await crypto.subtle.importKey(
                    "raw",
                    encoder.encode(password),
                    "PBKDF2",
                    false,
                    ["deriveKey"]
                );
                
                const key = await crypto.subtle.deriveKey(
                    {
                        name: "PBKDF2",
                        salt: salt,
                        iterations: 100000,
                        hash: "SHA-256"
                    },
                    keyMaterial,
                    { name: "AES-GCM", length: 256 },
                    false,
                    ["decrypt"]
                );
                
                // Decrypt using AES-256-GCM
                const decrypted = await crypto.subtle.decrypt(
                    { name: "AES-GCM", iv: iv },
                    key,
                    encryptedWithTag
                );
                
                const decoder = new TextDecoder();
                return JSON.parse(decoder.decode(decrypted));
            } catch (error) {
                console.error('Decryption failed:', error);
                return null;
            }
        }
        
        // Initialize Firebase with password prompt
        async function initializeFirebase() {
            // Check if password is stored in sessionStorage
            let password = sessionStorage.getItem('fbPassword');
            
            if (!password) {
                password = prompt('Enter password to access live scoring features:');
                if (!password) {
                    console.log('No password provided, Firebase features disabled');
                    return;
                }
            }
            
            const firebaseConfig = await decryptConfig(password);
            
            if (!firebaseConfig) {
                sessionStorage.removeItem('fbPassword');
                alert('Invalid password. Please refresh the page and try again.');
                return;
            }
            
            // Store password for session
            sessionStorage.setItem('fbPassword', password);
            
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            
            // Make Firestore available globally
            window.db = db;
            window.firestoreHelpers = { collection, doc, getDoc, getDocs, setDoc, updateDoc, query, where, orderBy, onSnapshot };
            
            console.log('Firebase initialized successfully');
        }
        
        initializeFirebase();
    </script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="images/bonville-logo.jpg" alt="Bonville Golf Resort">
                <h1>The Bonville G.C. Invitational</h1>
            </div>
            <button class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            <ul class="nav-links">
                <li><a href="#welcome" class="active">Welcome</a></li>
                <li><a href="#course">Course</a></li>
                <li><a href="#players">Players</a></li>
                <li><a href="#day1">Day 1</a></li>
                <li><a href="#dinner">Dinner</a></li>
                <li><a href="#day2">Day 2</a></li>
                <li><a href="#live-scores">Live Scores</a></li>
            </ul>
        </div>
    </nav>

    <!-- Header Live Leaderboard (shown only during active round) -->
    <div id="header-leaderboard" class="header-leaderboard" style="display: none;">
        <div class="header-leaderboard-container">
            <div class="header-leaderboard-title">üèÜ Live Leaderboard</div>
            <div class="header-leaderboard-content" id="header-leaderboard-content">
                <!-- Populated by JavaScript -->
            </div>
            <button onclick="toggleHeaderLeaderboard()" class="header-leaderboard-toggle" id="header-leaderboard-toggle">‚ñ≤</button>
        </div>
    </div>

    <!-- Welcome Section -->
    <section id="welcome" class="hero-section">
        <div class="video-background">
            <div id="youtube-player"></div>
        </div>
        <div class="video-overlay"></div>
        <div class="hero-content">
            <h1>The Bonville G.C. Invitational</h1>
            <h2>A Tradition Unlike Any Other</h2>
            <p>Welcome to an exclusive golf experience set amongst the stunning natural beauty of Bonville Golf Resort</p>
            <a href="#course" class="cta-button">Explore the Course</a>
        </div>
        <div class="scroll-indicator">‚ñº</div>
    </section>

    <!-- Course Section -->
    <section id="course" class="page-section course-section">
        <div class="container">
            <div class="section-header">
                <h2>The Course</h2>
                <div class="divider"></div>
                <p>Experience one of Australia's most stunning golf courses, nestled among towering pines and abundant wildlife</p>
            </div>
            
            <!-- Course Scorecard -->
            <div class="course-card">
                <h3>üìã Course Scorecard</h3>
                <div class="course-card-content">
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem; min-width: 800px;">
                            <thead>
                                <tr style="background: var(--masters-green); color: var(--masters-gold);">
                                    <th style="padding: 12px 8px; text-align: center;">Hole</th>
                                    <th style="padding: 12px 8px; text-align: center;">1</th>
                                    <th style="padding: 12px 8px; text-align: center;">2</th>
                                    <th style="padding: 12px 8px; text-align: center;">3</th>
                                    <th style="padding: 12px 8px; text-align: center;">4</th>
                                    <th style="padding: 12px 8px; text-align: center;">5</th>
                                    <th style="padding: 12px 8px; text-align: center;">6</th>
                                    <th style="padding: 12px 8px; text-align: center;">7</th>
                                    <th style="padding: 12px 8px; text-align: center;">8</th>
                                    <th style="padding: 12px 8px; text-align: center;">9</th>
                                    <th style="padding: 12px 8px; text-align: center; background: var(--masters-dark-green);">OUT</th>
                                    <th style="padding: 12px 8px; text-align: center;">10</th>
                                    <th style="padding: 12px 8px; text-align: center;">11</th>
                                    <th style="padding: 12px 8px; text-align: center;">12</th>
                                    <th style="padding: 12px 8px; text-align: center;">13</th>
                                    <th style="padding: 12px 8px; text-align: center;">14</th>
                                    <th style="padding: 12px 8px; text-align: center;">15</th>
                                    <th style="padding: 12px 8px; text-align: center;">16</th>
                                    <th style="padding: 12px 8px; text-align: center;">17</th>
                                    <th style="padding: 12px 8px; text-align: center;">18</th>
                                    <th style="padding: 12px 8px; text-align: center; background: var(--masters-dark-green);">IN</th>
                                    <th style="padding: 12px 8px; text-align: center; background: var(--masters-gold); color: var(--masters-dark-green);">TOT</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="background: var(--masters-cream);">
                                    <td style="padding: 10px 8px; text-align: center; font-weight: 700; color: var(--masters-brown);">Par</td>
                                    <td style="padding: 10px 8px; text-align: center;">4</td>
                                    <td style="padding: 10px 8px; text-align: center;">4</td>
                                    <td style="padding: 10px 8px; text-align: center;">3</td>
                                    <td style="padding: 10px 8px; text-align: center;">5</td>
                                    <td style="padding: 10px 8px; text-align: center;">3</td>
                                    <td style="padding: 10px 8px; text-align: center;">4</td>
                                    <td style="padding: 10px 8px; text-align: center;">5</td>
                                    <td style="padding: 10px 8px; text-align: center;">3</td>
                                    <td style="padding: 10px 8px; text-align: center;">4</td>
                                    <td style="padding: 10px 8px; text-align: center; font-weight: 700; background: rgba(0,103,71,0.1);">35</td>
                                    <td style="padding: 10px 8px; text-align: center;">5</td>
                                    <td style="padding: 10px 8px; text-align: center;">3</td>
                                    <td style="padding: 10px 8px; text-align: center;">4</td>
                                    <td style="padding: 10px 8px; text-align: center;">4</td>
                                    <td style="padding: 10px 8px; text-align: center;">5</td>
                                    <td style="padding: 10px 8px; text-align: center;">4</td>
                                    <td style="padding: 10px 8px; text-align: center;">4</td>
                                    <td style="padding: 10px 8px; text-align: center;">3</td>
                                    <td style="padding: 10px 8px; text-align: center;">4</td>
                                    <td style="padding: 10px 8px; text-align: center; font-weight: 700; background: rgba(0,103,71,0.1);">36</td>
                                    <td style="padding: 10px 8px; text-align: center; font-weight: 700; background: rgba(201,162,39,0.2);">71</td>
                                </tr>
                                <tr style="background: white;">
                                    <td style="padding: 10px 8px; text-align: center; font-weight: 700; color: var(--masters-brown);">Tallwood</td>
                                    <td style="padding: 10px 8px; text-align: center;">380</td>
                                    <td style="padding: 10px 8px; text-align: center;">346</td>
                                    <td style="padding: 10px 8px; text-align: center;">183</td>
                                    <td style="padding: 10px 8px; text-align: center;">485</td>
                                    <td style="padding: 10px 8px; text-align: center;">147</td>
                                    <td style="padding: 10px 8px; text-align: center;">335</td>
                                    <td style="padding: 10px 8px; text-align: center;">487</td>
                                    <td style="padding: 10px 8px; text-align: center;">182</td>
                                    <td style="padding: 10px 8px; text-align: center;">324</td>
                                    <td style="padding: 10px 8px; text-align: center; font-weight: 700; background: rgba(0,103,71,0.1);">2869</td>
                                    <td style="padding: 10px 8px; text-align: center;">456</td>
                                    <td style="padding: 10px 8px; text-align: center;">190</td>
                                    <td style="padding: 10px 8px; text-align: center;">425</td>
                                    <td style="padding: 10px 8px; text-align: center;">370</td>
                                    <td style="padding: 10px 8px; text-align: center;">505</td>
                                    <td style="padding: 10px 8px; text-align: center;">357</td>
                                    <td style="padding: 10px 8px; text-align: center;">372</td>
                                    <td style="padding: 10px 8px; text-align: center;">142</td>
                                    <td style="padding: 10px 8px; text-align: center;">460</td>
                                    <td style="padding: 10px 8px; text-align: center; font-weight: 700; background: rgba(0,103,71,0.1);">3277</td>
                                    <td style="padding: 10px 8px; text-align: center; font-weight: 700; background: rgba(201,162,39,0.2);">6146</td>
                                </tr>
                                <tr style="background: var(--masters-cream);">
                                    <td style="padding: 10px 8px; text-align: center; font-weight: 700; color: var(--masters-brown);">Bloodwood</td>
                                    <td style="padding: 10px 8px; text-align: center;">353</td>
                                    <td style="padding: 10px 8px; text-align: center;">308</td>
                                    <td style="padding: 10px 8px; text-align: center;">170</td>
                                    <td style="padding: 10px 8px; text-align: center;">465</td>
                                    <td style="padding: 10px 8px; text-align: center;">139</td>
                                    <td style="padding: 10px 8px; text-align: center;">328</td>
                                    <td style="padding: 10px 8px; text-align: center;">453</td>
                                    <td style="padding: 10px 8px; text-align: center;">158</td>
                                    <td style="padding: 10px 8px; text-align: center;">304</td>
                                    <td style="padding: 10px 8px; text-align: center; font-weight: 700; background: rgba(0,103,71,0.1);">2678</td>
                                    <td style="padding: 10px 8px; text-align: center;">419</td>
                                    <td style="padding: 10px 8px; text-align: center;">150</td>
                                    <td style="padding: 10px 8px; text-align: center;">372</td>
                                    <td style="padding: 10px 8px; text-align: center;">346</td>
                                    <td style="padding: 10px 8px; text-align: center;">466</td>
                                    <td style="padding: 10px 8px; text-align: center;">326</td>
                                    <td style="padding: 10px 8px; text-align: center;">340</td>
                                    <td style="padding: 10px 8px; text-align: center;">131</td>
                                    <td style="padding: 10px 8px; text-align: center;">436</td>
                                    <td style="padding: 10px 8px; text-align: center; font-weight: 700; background: rgba(0,103,71,0.1);">2986</td>
                                    <td style="padding: 10px 8px; text-align: center; font-weight: 700; background: rgba(201,162,39,0.2);">5664</td>
                                </tr>
                                <tr style="background: white;">
                                    <td style="padding: 10px 8px; text-align: center; font-weight: 700; color: var(--masters-brown);">Index</td>
                                    <td style="padding: 10px 8px; text-align: center;">2</td>
                                    <td style="padding: 10px 8px; text-align: center;">12</td>
                                    <td style="padding: 10px 8px; text-align: center;">8</td>
                                    <td style="padding: 10px 8px; text-align: center;">14</td>
                                    <td style="padding: 10px 8px; text-align: center;">16</td>
                                    <td style="padding: 10px 8px; text-align: center;">6</td>
                                    <td style="padding: 10px 8px; text-align: center;">18</td>
                                    <td style="padding: 10px 8px; text-align: center;">4</td>
                                    <td style="padding: 10px 8px; text-align: center;">10</td>
                                    <td style="padding: 10px 8px; text-align: center; background: rgba(0,103,71,0.1);"></td>
                                    <td style="padding: 10px 8px; text-align: center;">13</td>
                                    <td style="padding: 10px 8px; text-align: center;">9</td>
                                    <td style="padding: 10px 8px; text-align: center;">1</td>
                                    <td style="padding: 10px 8px; text-align: center;">3</td>
                                    <td style="padding: 10px 8px; text-align: center;">15</td>
                                    <td style="padding: 10px 8px; text-align: center;">7</td>
                                    <td style="padding: 10px 8px; text-align: center;">5</td>
                                    <td style="padding: 10px 8px; text-align: center;">11</td>
                                    <td style="padding: 10px 8px; text-align: center;">17</td>
                                    <td style="padding: 10px 8px; text-align: center; background: rgba(0,103,71,0.1);"></td>
                                    <td style="padding: 10px 8px; text-align: center; background: rgba(201,162,39,0.2);"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div style="margin-top: 20px; display: flex; justify-content: center; gap: 30px; flex-wrap: wrap;">
                        <div class="stat"><span class="stat-label">Course Rating</span><span class="stat-value">73.5</span></div>
                        <div class="stat"><span class="stat-label">Slope Rating</span><span class="stat-value">131</span></div>
                    </div>
                </div>
            </div>

            <!-- Hole Fly-Overs -->
            <div class="course-card" style="margin-top: 40px;">
                <h3>üé• Hole Fly-Overs</h3>
                <div class="course-card-content">
                    <p style="margin-bottom: 20px; color: var(--masters-brown); text-align: center;">Watch aerial flyover videos of each hole to plan your strategy and appreciate the stunning course layout.</p>
                    <div style="display: flex; justify-content: center; margin-bottom: 25px; padding: 0 15px;">
                        <a href="https://vimeo.com/287184640" target="_blank" class="cta-button" style="font-size: 1rem; white-space: nowrap;">Watch Course Flyover</a>
                    </div>
                    
                    <div class="hole-flyovers-grid">
                        <div class="hole-card">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-1/" target="_blank" class="hole-info"><h4>Hole 1</h4><p class="par">Par 4 ‚Ä¢ SI 2</p><p class="distance">T: 380m ‚Ä¢ B: 353m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/Z4OtMIxXbts?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                        <div class="hole-card">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-2/" target="_blank" class="hole-info"><h4>Hole 2</h4><p class="par">Par 4 ‚Ä¢ SI 12</p><p class="distance">T: 346m ‚Ä¢ B: 308m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/sffkGMJvAI0?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                        <div class="hole-card par3">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-3/" target="_blank" class="hole-info"><h4>Hole 3 ‚õ≥</h4><p class="par">Par 3 ‚Ä¢ SI 8</p><p class="distance">T: 183m ‚Ä¢ B: 170m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/Rs0itcMovSc?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                        <div class="hole-card">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-4/" target="_blank" class="hole-info"><h4>Hole 4</h4><p class="par">Par 5 ‚Ä¢ SI 14</p><p class="distance">T: 485m ‚Ä¢ B: 465m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/Pt3gE3Yp4E0?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                        <div class="hole-card par3">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-5/" target="_blank" class="hole-info"><h4>Hole 5 ‚õ≥</h4><p class="par">Par 3 ‚Ä¢ SI 16</p><p class="distance">T: 147m ‚Ä¢ B: 139m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/hURLN9CijB0?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                        <div class="hole-card">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-6/" target="_blank" class="hole-info"><h4>Hole 6</h4><p class="par">Par 4 ‚Ä¢ SI 6</p><p class="distance">T: 335m ‚Ä¢ B: 328m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/JfyZgLvPWTM?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                        <div class="hole-card longest-drive">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-7/" target="_blank" class="hole-info"><h4>Hole 7 üí™</h4><p class="par">Par 5 ‚Ä¢ SI 18</p><p class="distance">T: 487m ‚Ä¢ B: 453m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/sEL4EUaFmEQ?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                        <div class="hole-card par3">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-8/" target="_blank" class="hole-info"><h4>Hole 8 ‚õ≥</h4><p class="par">Par 3 ‚Ä¢ SI 4</p><p class="distance">T: 182m ‚Ä¢ B: 158m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/BX7nta7u27o?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                        <div class="hole-card">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-9/" target="_blank" class="hole-info"><h4>Hole 9</h4><p class="par">Par 4 ‚Ä¢ SI 10</p><p class="distance">T: 324m ‚Ä¢ B: 304m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/ukTcPM-HHig?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                        <div class="hole-card">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-10/" target="_blank" class="hole-info"><h4>Hole 10</h4><p class="par">Par 5 ‚Ä¢ SI 13</p><p class="distance">T: 456m ‚Ä¢ B: 419m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/F5SCMN0X3U4?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                        <div class="hole-card par3">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-11/" target="_blank" class="hole-info"><h4>Hole 11 ‚õ≥</h4><p class="par">Par 3 ‚Ä¢ SI 9</p><p class="distance">T: 190m ‚Ä¢ B: 150m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/e4wFkVsWaug?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                        <div class="hole-card">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-12/" target="_blank" class="hole-info"><h4>Hole 12</h4><p class="par">Par 4 ‚Ä¢ SI 1</p><p class="distance">T: 425m ‚Ä¢ B: 372m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/p9UBiaCt_es?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                        <div class="hole-card">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-13/" target="_blank" class="hole-info"><h4>Hole 13</h4><p class="par">Par 4 ‚Ä¢ SI 3</p><p class="distance">T: 370m ‚Ä¢ B: 346m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/eGR7M642U3g?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                        <div class="hole-card longest-drive">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-14/" target="_blank" class="hole-info"><h4>Hole 14 üí™</h4><p class="par">Par 5 ‚Ä¢ SI 15</p><p class="distance">T: 505m ‚Ä¢ B: 466m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/vmj7mOaVpfU?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                        <div class="hole-card">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-15/" target="_blank" class="hole-info"><h4>Hole 15</h4><p class="par">Par 4 ‚Ä¢ SI 7</p><p class="distance">T: 357m ‚Ä¢ B: 326m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/RY-BLD0ooBI?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                        <div class="hole-card">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-16/" target="_blank" class="hole-info"><h4>Hole 16</h4><p class="par">Par 4 ‚Ä¢ SI 5</p><p class="distance">T: 372m ‚Ä¢ B: 340m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/BRrfggDEmWs?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                        <div class="hole-card par3">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-17/" target="_blank" class="hole-info"><h4>Hole 17 ‚õ≥</h4><p class="par">Par 3 ‚Ä¢ SI 11</p><p class="distance">T: 142m ‚Ä¢ B: 131m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/wsXWvGKwY28?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                        <div class="hole-card">
                            <a href="https://www.bonvillegolf.com.au/hole/hole-18/" target="_blank" class="hole-info"><h4>Hole 18</h4><p class="par">Par 4 ‚Ä¢ SI 17</p><p class="distance">T: 460m ‚Ä¢ B: 436m</p></a>
                            <div class="hole-video"><iframe src="https://www.youtube.com/embed/YKwE-HvdXqg?list=PLKVEPOw12sI33XAzTCjXd8_VGYTmcV8Ps" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Players Section -->
    <section id="players" class="page-section players-section">
        <div class="container">
            <div class="section-header">
                <h2>The Players</h2>
                <div class="divider"></div>
                <p>Meet the eight competitors vying for glory at The Bonville G.C. Invitational</p>
            </div>
            
            <div class="players-grid">
                <!-- Player 1 -->
                <div class="player-card">
                    <img src="players/mck-tour-card-1.jpg" alt="Player 1" class="player-image">
                    <div class="player-info">
                        <h3>Mike Buller</h3>
                        <span class="handicap">HCP: 12</span>
                        <p class="player-skill">üéØ The "Mulligan Whisperer" ‚Äì has perfected the art of pretending that first shot never happened.</p>
                    </div>
                </div>

                <!-- Player 2 -->
                <div class="player-card">
                    <img src="players/adrian-platas.jpeg" alt="Adrian Platas" class="player-image">
                    <div class="player-info">
                        <h3>Adrian Platas</h3>
                        <span class="handicap">HCP: 8</span>
                        <p class="player-skill">ü•ò Like a fine paella, his drives are cooked low and slow ‚Äì short off the tee but always simmering toward the green. His tortilla flip putting technique? Chef's kiss!</p>
                    </div>
                </div>

                <!-- Player 3 -->
                <div class="player-card">
                    <img src="players/darren-shadlow.jpeg" alt="Darren Shadlow" class="player-image">
                    <div class="player-info">
                        <h3>Darren Shadlow</h3>
                        <span class="handicap">HCP: 15</span>
                        <p class="player-skill">üò§ Master of channeling his inner fury into pure golfing power. That bunker shot that wronged him? It'll never happen again.</p>
                    </div>
                </div>

                <!-- Player 4 -->
                <div class="player-card">
                    <img src="players/mcb-tour-card-2.jpg" alt="Player 4" class="player-image">
                    <div class="player-info">
                        <h3>Chris Anderson</h3>
                        <span class="handicap">HCP: 10</span>
                        <p class="player-skill">üç∫ The "19th Hole MVP" ‚Äì plays best when the clubhouse beer is in sight. Mysteriously excellent on holes 16-18.</p>
                    </div>
                </div>

                <!-- Player 5 -->
                <div class="player-card">
                    <img src="players/mcb-tour-card-3.jpg" alt="Player 5" class="player-image">
                    <div class="player-info">
                        <h3>Ryan Campbell</h3>
                        <span class="handicap">HCP: 6</span>
                        <p class="player-skill">üìè The "Human GPS" ‚Äì can read greens like a map but still somehow manages to three-putt while telling you exactly why.</p>
                    </div>
                </div>

                <!-- Player 6 -->
                <div class="player-card">
                    <img src="players/mcb-tour-card-4.jpg" alt="Player 6" class="player-image">
                    <div class="player-info">
                        <h3>Andrew Wilson</h3>
                        <span class="handicap">HCP: 14</span>
                        <p class="player-skill">üå≥ The "Tree Whisperer" ‚Äì his ball finds every tree on the course, but somehow always bounces back onto the fairway.</p>
                    </div>
                </div>

                <!-- Player 7 -->
                <div class="player-card">
                    <img src="players/mcb-tour-card-5.jpg" alt="Player 7" class="player-image">
                    <div class="player-info">
                        <h3>Steven Parker</h3>
                        <span class="handicap">HCP: 11</span>
                        <p class="player-skill">üé≠ The "Cart Path Maestro" ‚Äì gets more distance off concrete than grass. Groundskeepers fear him.</p>
                    </div>
                </div>

                <!-- Player 8 -->
                <div class="player-card">
                    <img src="players/mcb-tour-card-6.jpg" alt="Player 8" class="player-image">
                    <div class="player-info">
                        <h3>Daniel Hughes</h3>
                        <span class="handicap">HCP: 9</span>
                        <p class="player-skill">ü¶ò The "Wildlife Wrangler" ‚Äì has developed an uncanny ability to locate his ball next to kangaroos. They're basically his caddies now.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Day 1 Section - Team Tournament -->
    <section id="day1" class="page-section tournament-section">
        <div class="container">
            <div class="section-header">
                <h2>Day 1 - Team Championship</h2>
                <div class="divider"></div>
                <p>Four teams of two compete head-to-head. Winners advance to the Grand Final for the trophy!</p>
            </div>

            <div class="tee-times-container">
                <div class="tee-time-box">
                    <h4>‚õ≥ Group 1 Tee Time</h4>
                    <p class="tee-time">10:20 AM</p>
                </div>
                <div class="tee-time-box">
                    <h4>‚õ≥ Group 2 Tee Time</h4>
                    <p class="tee-time">10:10 AM</p>
                </div>
            </div>

        </div>
    </section>

    <!-- Dinner Section -->
    <section id="dinner" class="page-section dinner-section">
        <div class="container">
            <div class="section-header">
                <h2>Day 1 Awards Dinner</h2>
                <div class="divider"></div>
            </div>

            <!-- Dinner Info Details -->
            <div class="dinner-details">
                <p><strong>Time:</strong> 7:30 PM</p>
                <p><strong>Dress Code:</strong> Smart casual (collared shirts preferred)</p>
            </div>

            <div class="dinner-grid">
                <div class="dinner-card">
                    <img src="https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=800&h=400&fit=crop" alt="Fine Dining" class="dinner-image">
                    <div class="dinner-info">
                        <h3>Flooded Gums Restaurant</h3>
                        <p>Experience contemporary Australian cuisine in an elegant setting overlooking the championship course. Our award-winning chefs prepare seasonal dishes using the finest local produce.</p>
                        <p>Located within the stunning Bonville Golf Resort, the restaurant offers panoramic views of the lush fairways and native bushland.</p>
                        <a href="https://www.bonvillegolf.com.au/dining/#bynight" target="_blank" class="cta-button" style="margin-top: 20px; display: inline-block;">View Full Menu</a>
                    </div>
                </div>

                <div class="dinner-card">
                    <img src="https://images.unsplash.com/photo-1559339352-11d035aa65de?w=800&h=400&fit=crop" alt="Evening Ambiance" class="dinner-image">
                    <div class="dinner-info">
                        <h3>Tournament Dinner Menu</h3>
                        <ul class="menu-list">
                            <li><span class="menu-item">ü•ó Entr√©e: Moreton Bay Bug Tail</span></li>
                            <li><span class="menu-item">ü•© Main: Wagyu Beef Tenderloin</span></li>
                            <li><span class="menu-item">üç∞ Dessert: Dark Chocolate Fondant</span></li>
                            <li><span class="menu-item">üßÄ Cheese Selection & Port</span></li>
                            <li><span class="menu-item">üç∑ Premium Wine Pairing</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Day 2 Section - Individual Battle Royale -->
    <section id="day2" class="page-section tournament-section">
        <div class="container">
            <div class="section-header">
                <h2>Day 2 - Individual Championship</h2>
                <div class="divider"></div>
                <p>All eight players compete individually in an epic battle for ultimate glory!</p>
            </div>

            <div class="tee-times-container">
                <div class="tee-time-box">
                    <h4>‚õ≥ Group 1 Tee Time</h4>
                    <p class="tee-time">8:40 AM</p>
                </div>
                <div class="tee-time-box">
                    <h4>‚õ≥ Group 2 Tee Time</h4>
                    <p class="tee-time">8:30 AM</p>
                </div>
            </div>

        </div>
    </section>

    <!-- Live Scores Section -->
    <section id="live-scores" class="page-section live-scores-section">
        <div class="container">
            <div class="section-header">
                <h2>Live Scores</h2>
                <div class="divider"></div>
                <p>Enter your scores hole-by-hole during your round</p>
            </div>

            <!-- Round Setup -->
            <div id="round-setup" class="round-setup-container">
                <div class="setup-card">
                    <h3>Start a Round</h3>
                    
                    <div class="setup-field">
                        <label>Entry Type</label>
                        <div class="entry-type-options">
                            <label class="entry-type-option">
                                <input type="radio" name="entry-type" value="player" checked onchange="toggleEntryType()">
                                <span class="entry-type-label">Player</span>
                            </label>
                            <label class="entry-type-option">
                                <input type="radio" name="entry-type" value="team" onchange="toggleEntryType()">
                                <span class="entry-type-label">Team</span>
                            </label>
                        </div>
                    </div>

                    <div class="setup-field" id="player-select-field">
                        <label for="score-player">Player</label>
                        <select id="score-player" class="setup-select">
                            <option value="">Select Player</option>
                        </select>
                    </div>

                    <div class="setup-field" id="team-name-field" style="display: none;">
                        <label for="team-name">Team Name</label>
                        <input type="text" id="team-name" class="setup-input" placeholder="Enter team name">
                    </div>

                    <div class="setup-field">
                        <label for="score-date">Date</label>
                        <input type="date" id="score-date" class="setup-input">
                    </div>

                    <div class="setup-field">
                        <label>Tees</label>
                        <div class="tee-options">
                            <label class="tee-option">
                                <input type="radio" name="tees" value="tallwood" checked>
                                <span class="tee-label">Tallwood (6,146m)</span>
                            </label>
                            <label class="tee-option">
                                <input type="radio" name="tees" value="bloodwood">
                                <span class="tee-label">Bloodwood (5,664m)</span>
                            </label>
                        </div>
                    </div>

                    <button onclick="startRound()" class="cta-button start-round-btn">Start Round</button>
                </div>
            </div>

            <!-- Hole-by-Hole Score Entry (Hidden initially) -->
            <div id="score-entry" class="score-entry-container" style="display: none;">
                <!-- Player Info Bar -->
                <div class="score-player-bar">
                    <span id="current-player-name">Player Name</span>
                    <span id="current-tees-display">Tallwood</span>
                    <button onclick="exitRound()" class="exit-round-btn">‚úï</button>
                </div>

                <!-- Hole Navigation -->
                <div class="hole-navigation">
                    <button onclick="prevHole()" class="hole-nav-btn" id="prev-hole-btn">‚óÄ</button>
                    <div class="current-hole-info">
                        <h3 id="current-hole-number">Hole 1</h3>
                        <p id="current-hole-details">Par 4 ‚Ä¢ SI 2</p>
                        <p id="current-hole-distance">380m</p>
                    </div>
                    <button onclick="nextHole()" class="hole-nav-btn" id="next-hole-btn">‚ñ∂</button>
                </div>

                <!-- Score Input -->
                <div class="score-input-container">
                    <div class="score-input-row">
                        <label>Score</label>
                        <div class="score-stepper">
                            <button onclick="adjustScore(-1)" class="stepper-btn">‚àí</button>
                            <span id="current-score" class="stepper-value">-</span>
                            <button onclick="adjustScore(1)" class="stepper-btn">+</button>
                        </div>
                    </div>
                    <div class="score-input-row">
                        <label>Putts</label>
                        <div class="score-stepper">
                            <button onclick="adjustPutts(-1)" class="stepper-btn">‚àí</button>
                            <span id="current-putts" class="stepper-value">-</span>
                            <button onclick="adjustPutts(1)" class="stepper-btn">+</button>
                        </div>
                    </div>
                </div>

                <!-- Running Totals -->
                <div class="running-totals">
                    <div class="total-item">
                        <span class="total-label">Front 9</span>
                        <span id="front-9-total" class="total-value">-</span>
                    </div>
                    <div class="total-item">
                        <span class="total-label">Back 9</span>
                        <span id="back-9-total" class="total-value">-</span>
                    </div>
                    <div class="total-item total-gross">
                        <span class="total-label">Gross</span>
                        <span id="gross-total" class="total-value">-</span>
                    </div>
                    <div class="total-item total-net">
                        <span class="total-label">Net</span>
                        <span id="net-total" class="total-value">-</span>
                    </div>
                </div>

                <!-- Hole Quick Nav -->
                <div class="hole-quick-nav">
                    <div class="quick-nav-grid" id="quick-nav-grid">
                        <!-- Holes 1-18 will be generated by JS -->
                    </div>
                </div>

                <!-- Save Button -->
                <div class="save-round-container">
                    <button onclick="saveRound()" class="cta-button save-round-btn">Save Round</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Player Scorecard Modal -->
    <div id="scorecard-modal" class="scorecard-modal" style="display: none;">
        <div class="scorecard-modal-overlay" onclick="closeScorecardModal()"></div>
        <div class="scorecard-modal-content">
            <!-- Player Info Bar -->
            <div class="score-player-bar">
                <span id="modal-player-name">Player Name</span>
                <button onclick="closeScorecardModal()" class="exit-round-btn">‚úï</button>
            </div>
            
            <!-- Scorecard Table -->
            <div class="modal-scorecard-wrapper">
                <div id="modal-scorecard-table">
                    <!-- Generated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <h3>The Bonville G.C. Invitational</h3>
        <p>A Tradition Unlike Any Other</p>
        <p style="margin-top: 10px;">Bonville Golf Resort, NSW Australia</p>
        <img src="images/bonville-logo.jpg" alt="Bonville Logo" class="footer-logo">
        <p style="margin-top: 20px; font-size: 0.9rem; opacity: 0.8;">¬© 2026 The Bonville G.C. Invitational. All rights reserved.</p>
    </footer>

    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        // YouTube Player with early loop (15 seconds before end)
        let player;
        let loopCheckInterval;
        const LOOP_BEFORE_END = 17; // seconds before end to restart

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtube-player', {
                videoId: 'PdBEFTMmnYA',
                playerVars: {
                    autoplay: 1,
                    mute: 1,
                    controls: 0,
                    showinfo: 0,
                    rel: 0,
                    modestbranding: 1,
                    playsinline: 1,
                    enablejsapi: 1
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            event.target.playVideo();
            startLoopCheck();
        }

        function onPlayerStateChange(event) {
            // If video ends (shouldn't happen with our loop, but as fallback)
            if (event.data === YT.PlayerState.ENDED) {
                player.seekTo(0);
                player.playVideo();
            }
            // Restart loop check when video is playing
            if (event.data === YT.PlayerState.PLAYING) {
                startLoopCheck();
            }
        }

        function startLoopCheck() {
            // Clear any existing interval
            if (loopCheckInterval) {
                clearInterval(loopCheckInterval);
            }
            
            // Check every 500ms if we need to loop
            loopCheckInterval = setInterval(() => {
                if (player && player.getDuration && player.getCurrentTime) {
                    const duration = player.getDuration();
                    const currentTime = player.getCurrentTime();
                    
                    // Loop 15 seconds before the video ends
                    if (duration > 0 && currentTime >= duration - LOOP_BEFORE_END) {
                        player.seekTo(0);
                        player.playVideo();
                    }
                }
            }, 500);
        }

        // Smooth scrolling for navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                    // Update active nav link
                    document.querySelectorAll('.nav-links a').forEach(link => link.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });

        // Mobile menu toggle
        const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
        const navLinks = document.querySelector('.nav-links');
        
        mobileMenuToggle.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            mobileMenuToggle.classList.toggle('active');
        });

        // Close mobile menu when a link is clicked
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', () => {
                navLinks.classList.remove('active');
                mobileMenuToggle.classList.remove('active');
            });
        });

        // Update active nav on scroll
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.nav-links a');
            
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (scrollY >= sectionTop) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        });

        // Player list for team configuration (with handicaps)
        const allPlayers = [
            { id: 1, name: 'Mike Buller', handicap: 12 },
            { id: 2, name: 'Adrian Platas', handicap: 8 },
            { id: 3, name: 'Darren Shadlow', handicap: 15 },
            { id: 4, name: 'Chris Anderson', handicap: 10 },
            { id: 5, name: 'Ryan Campbell', handicap: 6 },
            { id: 6, name: 'Andrew Wilson', handicap: 14 },
            { id: 7, name: 'Steven Parker', handicap: 11 },
            { id: 8, name: 'Daniel Hughes', handicap: 9 }
        ];

        // Store team configurations
        let teamConfigs = {
            team1: { player1: null, player2: null },
            team2: { player1: null, player2: null },
            team3: { player1: null, player2: null },
            team4: { player1: null, player2: null }
        };

        // Store semi-final winners for the grand final
        let semiWinners = {
            semi1: null,
            semi2: null
        };

        // Get all selected player IDs
        function getSelectedPlayerIds() {
            const selectIds = [
                'team1-player1', 'team1-player2',
                'team2-player1', 'team2-player2',
                'team3-player1', 'team3-player2',
                'team4-player1', 'team4-player2'
            ];
            const selectedIds = [];
            selectIds.forEach(id => {
                const value = document.getElementById(id).value;
                if (value) selectedIds.push(value);
            });
            return selectedIds;
        }

        // Initialize player dropdowns
        function initializePlayerDropdowns() {
            const selects = document.querySelectorAll('.player-select');
            selects.forEach(select => {
                select.innerHTML = '<option value="">Select</option>';
                allPlayers.forEach(player => {
                    const option = document.createElement('option');
                    option.value = player.id;
                    option.textContent = player.name;
                    select.appendChild(option);
                });
            });
        }

        // Update player options to disable already selected players
        function updatePlayerOptions() {
            const selectedIds = getSelectedPlayerIds();
            const selects = document.querySelectorAll('.player-select');
            
            selects.forEach(select => {
                const currentValue = select.value;
                
                // Update each option's disabled state
                Array.from(select.options).forEach(option => {
                    if (option.value === '') return; // Skip placeholder
                    
                    // Disable if selected elsewhere (but not in this dropdown)
                    if (selectedIds.includes(option.value) && option.value !== currentValue) {
                        option.disabled = true;
                    } else {
                        option.disabled = false;
                    }
                });
            });

            // Update team configs for the calculate function
            const getFullPlayerName = (id) => {
                if (!id) return null;
                const player = allPlayers.find(p => p.id == id);
                return player ? player.name : null;
            };

            teamConfigs.team1 = { 
                player1: getFullPlayerName(document.getElementById('team1-player1').value), 
                player2: getFullPlayerName(document.getElementById('team1-player2').value) 
            };
            teamConfigs.team2 = { 
                player1: getFullPlayerName(document.getElementById('team2-player1').value), 
                player2: getFullPlayerName(document.getElementById('team2-player2').value) 
            };
            teamConfigs.team3 = { 
                player1: getFullPlayerName(document.getElementById('team3-player1').value), 
                player2: getFullPlayerName(document.getElementById('team3-player2').value) 
            };
            teamConfigs.team4 = { 
                player1: getFullPlayerName(document.getElementById('team4-player1').value), 
                player2: getFullPlayerName(document.getElementById('team4-player2').value) 
            };
        }

        // Fire confetti celebration
        function fireConfetti() {
            const duration = 6000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 9999 };

            function randomInRange(min, max) {
                return Math.random() * (max - min) + min;
            }

            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();

                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }

                const particleCount = 50 * (timeLeft / duration);

                // Confetti from both sides
                confetti(Object.assign({}, defaults, {
                    particleCount,
                    origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },
                    colors: ['#006747', '#C9A227', '#FFD700', '#FFFFFF']
                }));
                confetti(Object.assign({}, defaults, {
                    particleCount,
                    origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },
                    colors: ['#006747', '#C9A227', '#FFD700', '#FFFFFF']
                }));
            }, 250);
        }

        // Day 1 Team Tournament Calculator
        function calculateDay1Winners() {
            const leaderboardBody = document.getElementById('team-leaderboard-body');
            const rows = Array.from(leaderboardBody.querySelectorAll('.leaderboard-row'));
            
            // Helper to get team display name
            const getTeamName = (teamKey) => {
                const team = teamConfigs[teamKey];
                if (team.player1 && team.player2) {
                    return `${team.player1.split(' ')[1]} & ${team.player2.split(' ')[1]}`;
                }
                return 'TBD';
            };

            // Get team data with scores
            const teamScores = rows.map(row => {
                const teamNum = row.getAttribute('data-team');
                const scoreInput = document.getElementById(`team${teamNum}-score`);
                const score = parseInt(scoreInput.value) || null;
                
                return {
                    teamNum: teamNum,
                    teamKey: `team${teamNum}`,
                    name: getTeamName(`team${teamNum}`),
                    score: score,
                    element: row
                };
            });
            
            // Sort by score (lowest first for golf), teams without scores go to bottom
            teamScores.sort((a, b) => {
                if (a.score === null && b.score === null) return 0;
                if (a.score === null) return 1;
                if (b.score === null) return -1;
                return a.score - b.score;
            });
            
            // Calculate positions with ties (sequential, no skip)
            let currentPosition = 1;
            let previousScore = null;
            
            teamScores.forEach((team) => {
                if (team.score === null) {
                    team.displayPosition = '-';
                    team.positionRank = null;
                } else if (team.score === previousScore) {
                    team.displayPosition = currentPosition;
                    team.positionRank = currentPosition;
                } else {
                    if (previousScore !== null) {
                        currentPosition++;
                    }
                    team.displayPosition = currentPosition;
                    team.positionRank = currentPosition;
                }
                previousScore = team.score;
            });
            
            // Clear and re-append sorted rows
            leaderboardBody.innerHTML = '';
            teamScores.forEach((team) => {
                let rowClass = 'leaderboard-row';
                
                // Highlight top 3 positions
                if (team.positionRank !== null) {
                    if (team.positionRank === 1) rowClass += ' gold';
                    else if (team.positionRank === 2) rowClass += ' silver';
                    else if (team.positionRank === 3) rowClass += ' bronze';
                }
                
                const row = document.createElement('div');
                row.className = rowClass;
                row.setAttribute('data-team', team.teamNum);
                row.innerHTML = `
                    <span class="position">${team.displayPosition}</span>
                    <span class="team-name-config">
                        <select id="team${team.teamNum}-player1" class="player-select" onchange="updatePlayerOptions()">
                            <option value="">Player 1</option>
                        </select>
                        <span class="team-ampersand">&</span>
                        <select id="team${team.teamNum}-player2" class="player-select" onchange="updatePlayerOptions()">
                            <option value="">Player 2</option>
                        </select>
                    </span>
                    <span class="team-score">
                        <input type="number" class="team-score-input" id="team${team.teamNum}-score" value="${team.score || ''}" placeholder="-" min="0">
                    </span>
                `;
                leaderboardBody.appendChild(row);
            });
            
            // Re-initialize dropdowns and restore selections
            initializePlayerDropdowns();
            
            // Restore player selections
            teamScores.forEach((team) => {
                const config = teamConfigs[team.teamKey];
                if (config.player1) {
                    const player = allPlayers.find(p => p.name === config.player1);
                    if (player) document.getElementById(`team${team.teamNum}-player1`).value = player.id;
                }
                if (config.player2) {
                    const player = allPlayers.find(p => p.name === config.player2);
                    if (player) document.getElementById(`team${team.teamNum}-player2`).value = player.id;
                }
            });
            
            updatePlayerOptions();
            
            // Fire confetti and update champion text if we have a winner
            const winners = teamScores.filter(t => t.positionRank === 1 && t.score !== null);
            if (winners.length > 0) {
                const championText = document.getElementById('champion-text');
                if (winners.length === 1) {
                    championText.innerHTML = `üéâ <strong>${winners[0].name}</strong> are the Day 1 Champions! üéâ`;
                } else {
                    const names = winners.map(w => w.name).join(' & ');
                    championText.innerHTML = `üéâ <strong>${names}</strong> are tied for the Day 1 Championship! üéâ`;
                }
                fireConfetti();
            }
        }

        // Initialize the Day 2 leaderboard with all players
        function initializeLeaderboard() {
            const leaderboardBody = document.getElementById('leaderboard-body');
            if (!leaderboardBody) return;
            leaderboardBody.innerHTML = '';
            
            allPlayers.forEach((player, index) => {
                const row = document.createElement('div');
                row.className = 'leaderboard-row';
                row.setAttribute('data-player-id', player.id);
                row.innerHTML = `
                    <span class="position">${index + 1}</span>
                    <span class="player-name">${player.name}</span>
                    <span class="player-hcp">${player.handicap}</span>
                    <span class="player-gross">
                        <input type="number" class="gross-score-input" id="gross-${player.id}" 
                               placeholder="-" min="50" max="150" onchange="calculateNetScore(${player.id})">
                    </span>
                    <span class="player-net" id="net-${player.id}">-</span>
                `;
                leaderboardBody.appendChild(row);
            });
        }

        // Calculate net score for a player (gross - handicap)
        function calculateNetScore(playerId) {
            const player = allPlayers.find(p => p.id === playerId);
            const grossInput = document.getElementById(`gross-${playerId}`);
            const netSpan = document.getElementById(`net-${playerId}`);
            
            const grossScore = parseInt(grossInput.value);
            if (grossScore && !isNaN(grossScore)) {
                const netScore = grossScore - player.handicap;
                netSpan.textContent = netScore;
            } else {
                netSpan.textContent = '-';
            }
        }

        // Update leaderboard - sort by net score and show confetti for winner
        function updateLeaderboard() {
            const leaderboardBody = document.getElementById('leaderboard-body');
            const rows = Array.from(leaderboardBody.querySelectorAll('.leaderboard-row'));
            
            // Get player data with scores
            const playerScores = rows.map(row => {
                const playerId = parseInt(row.getAttribute('data-player-id'));
                const player = allPlayers.find(p => p.id === playerId);
                const grossInput = document.getElementById(`gross-${playerId}`);
                const grossScore = parseInt(grossInput.value) || null;
                const netScore = grossScore ? grossScore - player.handicap : null;
                
                return {
                    id: playerId,
                    name: player.name,
                    handicap: player.handicap,
                    gross: grossScore,
                    net: netScore,
                    element: row
                };
            });
            
            // Sort by net score (lowest first), players without scores go to bottom
            playerScores.sort((a, b) => {
                if (a.net === null && b.net === null) return 0;
                if (a.net === null) return 1;
                if (b.net === null) return -1;
                return a.net - b.net;
            });
            
            // Calculate positions with ties
            // Players with same net score get the same position
            // Next different score gets the next sequential position (not skipping)
            let currentPosition = 1;
            let previousNet = null;
            
            playerScores.forEach((player, index) => {
                if (player.net === null) {
                    player.displayPosition = '-';
                    player.positionRank = null;
                } else if (player.net === previousNet) {
                    // Same score as previous player - same position
                    player.displayPosition = currentPosition;
                    player.positionRank = currentPosition;
                } else {
                    // New score - advance to next position (sequential, no skip)
                    if (previousNet !== null) {
                        currentPosition++;
                    }
                    player.displayPosition = currentPosition;
                    player.positionRank = currentPosition;
                }
                previousNet = player.net;
            });
            
            // Clear and re-append sorted rows
            leaderboardBody.innerHTML = '';
            playerScores.forEach((player) => {
                const row = document.createElement('div');
                let rowClass = 'leaderboard-row';
                
                // Highlight top 3 positions (including ties)
                if (player.positionRank !== null) {
                    if (player.positionRank === 1) rowClass += ' gold';
                    else if (player.positionRank === 2) rowClass += ' silver';
                    else if (player.positionRank === 3) rowClass += ' bronze';
                }
                
                row.className = rowClass;
                row.setAttribute('data-player-id', player.id);
                row.innerHTML = `
                    <span class="position">${player.displayPosition}</span>
                    <span class="player-name">${player.name}</span>
                    <span class="player-hcp">${player.handicap}</span>
                    <span class="player-gross">
                        <input type="number" class="gross-score-input" id="gross-${player.id}" 
                               value="${player.gross || ''}" placeholder="-" min="50" max="150" 
                               onchange="calculateNetScore(${player.id})">
                    </span>
                    <span class="player-net" id="net-${player.id}">${player.net !== null ? player.net : '-'}</span>
                `;
                leaderboardBody.appendChild(row);
            });
            
            // Fire confetti if we have a winner (at least one player with a score)
            const hasScores = playerScores.some(p => p.net !== null);
            if (hasScores) {
                fireConfetti();
            }
        }

        // Course data for Live Scores
        const courseData = {
            par: 71,
            holes: {
                1: { par: 4, si: 2, tallwood: 380, bloodwood: 353 },
                2: { par: 4, si: 12, tallwood: 346, bloodwood: 308 },
                3: { par: 3, si: 8, tallwood: 183, bloodwood: 170 },
                4: { par: 5, si: 14, tallwood: 485, bloodwood: 465 },
                5: { par: 3, si: 16, tallwood: 147, bloodwood: 139 },
                6: { par: 4, si: 6, tallwood: 335, bloodwood: 328 },
                7: { par: 5, si: 18, tallwood: 487, bloodwood: 453 },
                8: { par: 3, si: 4, tallwood: 182, bloodwood: 158 },
                9: { par: 4, si: 10, tallwood: 324, bloodwood: 304 },
                10: { par: 5, si: 13, tallwood: 456, bloodwood: 419 },
                11: { par: 3, si: 9, tallwood: 190, bloodwood: 150 },
                12: { par: 4, si: 1, tallwood: 425, bloodwood: 372 },
                13: { par: 4, si: 3, tallwood: 370, bloodwood: 346 },
                14: { par: 5, si: 15, tallwood: 505, bloodwood: 466 },
                15: { par: 4, si: 7, tallwood: 357, bloodwood: 326 },
                16: { par: 4, si: 5, tallwood: 372, bloodwood: 340 },
                17: { par: 3, si: 11, tallwood: 142, bloodwood: 131 },
                18: { par: 4, si: 17, tallwood: 460, bloodwood: 436 }
            }
        };

        // Live Scores state
        let currentRound = {
            playerId: null,
            playerName: '',
            playerHandicap: 0,
            date: '',
            tees: 'tallwood',
            currentHole: 1,
            holes: {}
        };

        // Toggle between player and team entry type
        function toggleEntryType() {
            const entryType = document.querySelector('input[name="entry-type"]:checked').value;
            const playerField = document.getElementById('player-select-field');
            const teamField = document.getElementById('team-name-field');
            
            if (entryType === 'player') {
                playerField.style.display = 'block';
                teamField.style.display = 'none';
            } else {
                playerField.style.display = 'none';
                teamField.style.display = 'block';
            }
        }
        
        // Initialize Live Scores player dropdown
        function initializeLiveScoresPlayers() {
            const playerSelect = document.getElementById('score-player');
            console.log('initializeLiveScoresPlayers called, playerSelect:', playerSelect);
            console.log('allPlayers:', allPlayers);
            if (!playerSelect) return;
            
            playerSelect.innerHTML = '<option value="">Select Player</option>';
            allPlayers.forEach(player => {
                const option = document.createElement('option');
                option.value = player.id;
                option.textContent = player.name;
                playerSelect.appendChild(option);
            });
            console.log('Player dropdown populated with', allPlayers.length, 'players');

            // Set default date to today
            const dateInput = document.getElementById('score-date');
            if (dateInput) {
                const today = new Date().toISOString().split('T')[0];
                dateInput.value = today;
            }

            // Generate quick nav buttons
            generateQuickNav();
        }

        // Generate hole quick navigation buttons
        function generateQuickNav() {
            const grid = document.getElementById('quick-nav-grid');
            if (!grid) return;
            
            grid.innerHTML = '';
            for (let i = 1; i <= 18; i++) {
                const btn = document.createElement('button');
                btn.className = 'quick-nav-btn' + (i === 1 ? ' active' : '');
                btn.textContent = i;
                btn.onclick = () => goToHole(i);
                btn.id = `quick-nav-${i}`;
                grid.appendChild(btn);
            }
        }

        // Start a new round
        function startRound() {
            const entryType = document.querySelector('input[name="entry-type"]:checked').value;
            const playerSelect = document.getElementById('score-player');
            const teamNameInput = document.getElementById('team-name');
            const dateInput = document.getElementById('score-date');
            const teesInput = document.querySelector('input[name="tees"]:checked');

            let playerName, playerId, playerHandicap;

            if (entryType === 'player') {
                if (!playerSelect.value) {
                    alert('Please select a player');
                    return;
                }
                const player = allPlayers.find(p => p.id == playerSelect.value);
                playerId = player.id;
                playerName = player.name;
                playerHandicap = player.handicap;
            } else {
                if (!teamNameInput.value.trim()) {
                    alert('Please enter a team name');
                    return;
                }
                // Use a unique ID for teams based on timestamp
                playerId = 'team_' + Date.now();
                playerName = teamNameInput.value.trim();
                playerHandicap = 0; // Teams don't have handicap
            }

            if (!dateInput.value) {
                alert('Please select a date');
                return;
            }
            
            currentRound = {
                playerId: playerId,
                playerName: playerName,
                playerHandicap: playerHandicap,
                entryType: entryType,
                date: dateInput.value,
                tees: teesInput.value,
                currentHole: 1,
                holes: {}
            };

            // Initialize all holes with null scores
            for (let i = 1; i <= 18; i++) {
                currentRound.holes[i] = { score: null, putts: null };
            }

            // Show score entry, hide setup
            document.getElementById('round-setup').style.display = 'none';
            document.getElementById('score-entry').style.display = 'block';

            // Update player info bar
            document.getElementById('current-player-name').textContent = playerName;
            document.getElementById('current-tees-display').textContent = 
                teesInput.value === 'tallwood' ? 'Tallwood' : 'Bloodwood';

            // Show first hole
            updateHoleDisplay();
            
            // Save active round to Firebase and show header leaderboard
            saveActiveRoundToFirebase();
            showHeaderLeaderboard();
        }
        
        // Save active round status to Firebase
        async function saveActiveRoundToFirebase() {
            if (!window.db || !window.firestoreHelpers) {
                console.log('Firebase not initialized');
                return;
            }
            
            try {
                const { doc, setDoc } = window.firestoreHelpers;
                
                const activeRoundData = {
                    playerId: currentRound.playerId,
                    playerName: currentRound.playerName,
                    playerHandicap: currentRound.playerHandicap,
                    date: currentRound.date,
                    tees: currentRound.tees,
                    currentHole: currentRound.currentHole,
                    holes: currentRound.holes,
                    startedAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                };
                
                await setDoc(doc(window.db, 'activeRounds', currentRound.playerId.toString()), activeRoundData);
                console.log('Active round saved to Firebase');
            } catch (error) {
                console.error('Error saving active round:', error);
            }
        }
        
        // Update active round scores in Firebase
        async function updateActiveRoundInFirebase() {
            if (!window.db || !window.firestoreHelpers || !currentRound) {
                return;
            }
            
            try {
                const { doc, updateDoc } = window.firestoreHelpers;
                
                await updateDoc(doc(window.db, 'activeRounds', currentRound.playerId.toString()), {
                    currentHole: currentRound.currentHole,
                    holes: currentRound.holes,
                    lastUpdated: new Date().toISOString()
                });
            } catch (error) {
                console.error('Error updating active round:', error);
            }
        }
        
        // Remove active round from Firebase
        async function removeActiveRoundFromFirebase() {
            if (!window.db || !window.firestoreHelpers || !currentRound) {
                return;
            }
            
            try {
                const { doc } = window.firestoreHelpers;
                const { deleteDoc } = await import("https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js");
                
                await deleteDoc(doc(window.db, 'activeRounds', currentRound.playerId.toString()));
                console.log('Active round removed from Firebase');
            } catch (error) {
                console.error('Error removing active round:', error);
            }
        }
        
        // Mark round as finished in Firebase (keep on leaderboard but show as complete)
        async function markRoundAsFinishedInFirebase() {
            if (!window.db || !window.firestoreHelpers || !currentRound) {
                return;
            }
            
            try {
                const { doc, updateDoc } = window.firestoreHelpers;
                
                await updateDoc(doc(window.db, 'activeRounds', currentRound.playerId.toString()), {
                    status: 'finished',
                    finishedAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                });
                console.log('Round marked as finished in Firebase');
            } catch (error) {
                console.error('Error marking round as finished:', error);
            }
        }

        // Exit round (go back to setup)
        async function exitRound() {
            if (confirm('Are you sure you want to exit? Unsaved scores will be lost.')) {
                // Remove active round from Firebase
                await removeActiveRoundFromFirebase();
                
                document.getElementById('round-setup').style.display = 'block';
                document.getElementById('score-entry').style.display = 'none';
                
                // Hide header leaderboard
                hideHeaderLeaderboard();
                
                // Clear current round
                currentRound = null;
            }
        }
        
        // Real-time listener unsubscribe function
        let activeRoundsUnsubscribe = null;
        
        // Position the header leaderboard below navbar
        function positionHeaderLeaderboard() {
            const headerLb = document.getElementById('header-leaderboard');
            const navbar = document.querySelector('.navbar');
            
            if (headerLb && navbar) {
                const navbarHeight = navbar.offsetHeight;
                headerLb.style.top = navbarHeight + 'px';
            }
        }
        
        // Show the header leaderboard
        function showHeaderLeaderboard() {
            const headerLb = document.getElementById('header-leaderboard');
            
            // Position header leaderboard right below the navbar
            positionHeaderLeaderboard();
            
            // Re-position on window resize
            window.addEventListener('resize', positionHeaderLeaderboard);
            
            headerLb.style.display = 'block';
            document.body.classList.add('header-lb-active');
            
            // Start real-time listener
            startActiveRoundsListener();
        }
        
        // Hide the header leaderboard
        function hideHeaderLeaderboard() {
            const headerLb = document.getElementById('header-leaderboard');
            headerLb.style.display = 'none';
            document.body.classList.remove('header-lb-active');
            
            // Remove resize listener
            window.removeEventListener('resize', positionHeaderLeaderboard);
            
            // Stop real-time listener
            stopActiveRoundsListener();
        }
        
        // Start real-time listener for active rounds
        function startActiveRoundsListener() {
            if (!window.db || !window.firestoreHelpers) {
                console.log('Firebase not initialized, falling back to manual updates');
                updateHeaderLeaderboard();
                return;
            }
            
            // Stop any existing listener first
            stopActiveRoundsListener();
            
            try {
                const { collection, onSnapshot } = window.firestoreHelpers;
                
                activeRoundsUnsubscribe = onSnapshot(
                    collection(window.db, 'activeRounds'),
                    (snapshot) => {
                        const activeRounds = [];
                        snapshot.forEach(doc => {
                            activeRounds.push({ id: doc.id, ...doc.data() });
                        });
                        
                        // Update the leaderboard with new data
                        renderHeaderLeaderboard(activeRounds);
                    },
                    (error) => {
                        console.error('Error listening to active rounds:', error);
                    }
                );
                
                console.log('Real-time listener started for active rounds');
            } catch (error) {
                console.error('Error starting listener:', error);
                updateHeaderLeaderboard();
            }
        }
        
        // Stop real-time listener
        function stopActiveRoundsListener() {
            if (activeRoundsUnsubscribe) {
                activeRoundsUnsubscribe();
                activeRoundsUnsubscribe = null;
                console.log('Real-time listener stopped');
            }
        }
        
        // Toggle header leaderboard collapse/expand
        function toggleHeaderLeaderboard() {
            const content = document.getElementById('header-leaderboard-content');
            const toggle = document.getElementById('header-leaderboard-toggle');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                toggle.textContent = '‚ñ≤';
            } else {
                content.classList.add('collapsed');
                toggle.textContent = '‚ñº';
            }
        }
        
        // Update header leaderboard with current scores from Firebase (manual fetch)
        async function updateHeaderLeaderboard() {
            const container = document.getElementById('header-leaderboard-content');
            if (!container) return;
            
            // Fetch active rounds from Firebase
            let activeRounds = [];
            
            if (window.db && window.firestoreHelpers) {
                try {
                    const { collection, getDocs } = window.firestoreHelpers;
                    const snapshot = await getDocs(collection(window.db, 'activeRounds'));
                    
                    snapshot.forEach(doc => {
                        activeRounds.push({ id: doc.id, ...doc.data() });
                    });
                } catch (error) {
                    console.error('Error fetching active rounds:', error);
                }
            }
            
            // If no active rounds in Firebase, check if current local round exists
            if (activeRounds.length === 0 && currentRound) {
                // Fallback to local current round
                activeRounds.push({
                    playerId: currentRound.playerId,
                    playerName: currentRound.playerName,
                    playerHandicap: currentRound.playerHandicap,
                    holes: currentRound.holes,
                    currentHole: currentRound.currentHole
                });
            }
            
            // Render using the shared function
            renderHeaderLeaderboard(activeRounds);
        }
        
        // Render header leaderboard with provided active rounds data
        function renderHeaderLeaderboard(activeRounds) {
            const container = document.getElementById('header-leaderboard-content');
            if (!container) return;
            
            // If no active rounds, show a message
            if (!activeRounds || activeRounds.length === 0) {
                container.innerHTML = '<div class="header-lb-empty">No active rounds</div>';
                return;
            }
            
            // Build leaderboard data from active rounds only
            const leaderboardData = activeRounds.map(round => {
                let holesPlayed = 0;
                let totalScore = 0;
                let totalPar = 0;
                
                // Calculate scores from holes data
                for (let i = 1; i <= 18; i++) {
                    if (round.holes && round.holes[i] && round.holes[i].score !== null) {
                        holesPlayed = i;
                        totalScore += round.holes[i].score;
                        totalPar += courseData.holes[i].par;
                    }
                }
                
                return {
                    id: round.playerId,
                    name: round.playerName,
                    handicap: round.playerHandicap,
                    holesPlayed: holesPlayed,
                    currentHole: round.currentHole || holesPlayed,
                    totalScore: totalScore,
                    totalPar: totalPar,
                    scoreToPar: totalScore - totalPar,
                    isCurrentPlayer: currentRound && currentRound.playerId == round.playerId,
                    isFinished: round.status === 'finished'
                };
            });
            
            // Sort by score to par (lowest first), then by holes played (more holes first)
            leaderboardData.sort((a, b) => {
                // Players with scores come first
                if (a.holesPlayed > 0 && b.holesPlayed === 0) return -1;
                if (b.holesPlayed > 0 && a.holesPlayed === 0) return 1;
                if (a.holesPlayed === 0 && b.holesPlayed === 0) return 0;
                
                // Sort by score to par
                if (a.scoreToPar !== b.scoreToPar) return a.scoreToPar - b.scoreToPar;
                
                // If tied, more holes played is better
                return b.holesPlayed - a.holesPlayed;
            });
            
            // Render leaderboard
            container.innerHTML = leaderboardData.map((player, index) => {
                const pos = index + 1;
                let scoreClass = 'even-par';
                let scoreDisplay = 'E';
                
                if (player.holesPlayed > 0) {
                    if (player.scoreToPar < 0) {
                        scoreClass = 'under-par';
                        scoreDisplay = player.scoreToPar.toString();
                    } else if (player.scoreToPar > 0) {
                        scoreClass = 'over-par';
                        scoreDisplay = '+' + player.scoreToPar;
                    }
                } else {
                    scoreDisplay = '-';
                }
                
                let playerClass = 'header-lb-player';
                if (pos === 1 && player.holesPlayed > 0) playerClass += ' leader';
                if (player.isCurrentPlayer) playerClass += ' current-player';
                if (!player.isFinished) playerClass += ' live';
                if (player.isFinished) playerClass += ' finished';
                
                const holeDisplay = player.isFinished ? 'F' : (player.currentHole > 0 ? `H${player.currentHole}` : 'Tee');
                
                return `
                    <div class="${playerClass}" onclick="openScorecardModal('${player.id}')">
                        <span class="header-lb-pos">${pos}</span>
                        <span class="header-lb-name">${player.name}</span>
                        <span class="header-lb-hole">${holeDisplay}</span>
                        <span class="header-lb-score ${scoreClass}">${scoreDisplay}</span>
                    </div>
                `;
            }).join('');
        }
        
        // Modal state
        let modalRoundData = null;
        
        // Open scorecard modal for a player
        async function openScorecardModal(playerId) {
            // Fetch player's round data from Firebase
            if (!window.db || !window.firestoreHelpers) {
                console.log('Firebase not initialized');
                return;
            }
            
            try {
                const { doc, getDoc } = window.firestoreHelpers;
                const docSnap = await getDoc(doc(window.db, 'activeRounds', playerId.toString()));
                
                if (!docSnap.exists()) {
                    console.log('No active round found for player');
                    return;
                }
                
                modalRoundData = docSnap.data();
                
                // Populate modal header
                document.getElementById('modal-player-name').textContent = modalRoundData.playerName;
                
                // Generate scorecard table
                generateModalScorecard();
                
                // Show modal
                document.getElementById('scorecard-modal').style.display = 'flex';
                
            } catch (error) {
                console.error('Error fetching player round:', error);
            }
        }
        
        // Close scorecard modal
        function closeScorecardModal() {
            document.getElementById('scorecard-modal').style.display = 'none';
            modalRoundData = null;
        }
        
        // Delete a round
        async function confirmDeleteRound() {
            if (!modalRoundData) return;
            
            await deleteRoundFromFirebase(modalRoundData.playerId);
            closeScorecardModal();
        }
        
        // Delete a round from Firebase
        async function deleteRoundFromFirebase(playerId) {
            if (!window.db || !window.firestoreHelpers) {
                console.log('Firebase not initialized');
                return;
            }
            
            try {
                const { doc } = window.firestoreHelpers;
                const { deleteDoc } = await import("https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js");
                
                await deleteDoc(doc(window.db, 'activeRounds', playerId.toString()));
                console.log('Round deleted from Firebase');
                
                // If no more active rounds, hide the header leaderboard
                const { collection, getDocs } = window.firestoreHelpers;
                const snapshot = await getDocs(collection(window.db, 'activeRounds'));
                
                if (snapshot.empty) {
                    hideHeaderLeaderboard();
                }
            } catch (error) {
                console.error('Error deleting round:', error);
                alert('Error deleting round. Please try again.');
            }
        }
        
        // Generate the scorecard table
        function generateModalScorecard() {
            if (!modalRoundData) return;
            
            const container = document.getElementById('modal-scorecard-table');
            const isFinished = modalRoundData.status === 'finished';
            const currentHole = modalRoundData.currentHole || 1;
            
            // Calculate totals
            let front9Score = 0, back9Score = 0, front9Count = 0, back9Count = 0;
            let front9Par = 0, back9Par = 0;
            
            for (let i = 1; i <= 9; i++) {
                front9Par += courseData.holes[i].par;
                if (modalRoundData.holes[i] && modalRoundData.holes[i].score !== null) {
                    front9Score += modalRoundData.holes[i].score;
                    front9Count++;
                }
            }
            for (let i = 10; i <= 18; i++) {
                back9Par += courseData.holes[i].par;
                if (modalRoundData.holes[i] && modalRoundData.holes[i].score !== null) {
                    back9Score += modalRoundData.holes[i].score;
                    back9Count++;
                }
            }
            
            const totalScore = front9Score + back9Score;
            const totalPar = front9Par + back9Par;
            const netScore = totalScore - modalRoundData.playerHandicap;
            
            // Helper to get score cell style
            const getScoreCellStyle = (hole, score) => {
                let style = 'padding: 10px 8px; text-align: center;';
                const isCurrentHole = !isFinished && hole === currentHole;
                
                if (isCurrentHole) {
                    style += ' background: rgba(201, 162, 39, 0.4); animation: currentHolePulse 2s ease-in-out infinite;';
                }
                
                if (score !== null) {
                    const par = courseData.holes[hole].par;
                    if (score < par) {
                        style += ' color: #006747; font-weight: 700;'; // Under par - green
                    } else if (score > par) {
                        style += ' color: #c00; font-weight: 700;'; // Over par - red
                    }
                }
                
                return style;
            };
            
            // Build hole numbers row
            let holeRow = '<th style="padding: 12px 8px; text-align: center;">Hole</th>';
            for (let i = 1; i <= 9; i++) {
                const isCurrentHole = !isFinished && i === currentHole;
                const highlightStyle = isCurrentHole ? ' background: rgba(201, 162, 39, 0.6);' : '';
                holeRow += `<th style="padding: 12px 8px; text-align: center;${highlightStyle}">${i}</th>`;
            }
            holeRow += '<th style="padding: 12px 8px; text-align: center; background: var(--masters-dark-green);">OUT</th>';
            for (let i = 10; i <= 18; i++) {
                const isCurrentHole = !isFinished && i === currentHole;
                const highlightStyle = isCurrentHole ? ' background: rgba(201, 162, 39, 0.6);' : '';
                holeRow += `<th style="padding: 12px 8px; text-align: center;${highlightStyle}">${i}</th>`;
            }
            holeRow += '<th style="padding: 12px 8px; text-align: center; background: var(--masters-dark-green);">IN</th>';
            holeRow += '<th style="padding: 12px 8px; text-align: center; background: var(--masters-gold); color: var(--masters-dark-green);">TOT</th>';
            
            // Build par row
            let parRow = '<td style="padding: 10px 8px; text-align: center; font-weight: 700; color: var(--masters-brown);">Par</td>';
            for (let i = 1; i <= 9; i++) {
                parRow += `<td style="padding: 10px 8px; text-align: center;">${courseData.holes[i].par}</td>`;
            }
            parRow += `<td style="padding: 10px 8px; text-align: center; font-weight: 700; background: rgba(0,103,71,0.1);">${front9Par}</td>`;
            for (let i = 10; i <= 18; i++) {
                parRow += `<td style="padding: 10px 8px; text-align: center;">${courseData.holes[i].par}</td>`;
            }
            parRow += `<td style="padding: 10px 8px; text-align: center; font-weight: 700; background: rgba(0,103,71,0.1);">${back9Par}</td>`;
            parRow += `<td style="padding: 10px 8px; text-align: center; font-weight: 700; background: rgba(201,162,39,0.2);">${totalPar}</td>`;
            
            // Build score row
            let scoreRow = `<td style="padding: 10px 8px; text-align: center; font-weight: 700; color: var(--masters-brown);">Score</td>`;
            for (let i = 1; i <= 9; i++) {
                const score = modalRoundData.holes[i]?.score;
                const displayScore = score !== null ? score : '-';
                scoreRow += `<td style="${getScoreCellStyle(i, score)}">${displayScore}</td>`;
            }
            scoreRow += `<td style="padding: 10px 8px; text-align: center; font-weight: 700; background: rgba(0,103,71,0.1);">${front9Count > 0 ? front9Score : '-'}</td>`;
            for (let i = 10; i <= 18; i++) {
                const score = modalRoundData.holes[i]?.score;
                const displayScore = score !== null ? score : '-';
                scoreRow += `<td style="${getScoreCellStyle(i, score)}">${displayScore}</td>`;
            }
            scoreRow += `<td style="padding: 10px 8px; text-align: center; font-weight: 700; background: rgba(0,103,71,0.1);">${back9Count > 0 ? back9Score : '-'}</td>`;
            scoreRow += `<td style="padding: 10px 8px; text-align: center; font-weight: 700; background: rgba(201,162,39,0.2);">${(front9Count + back9Count) > 0 ? totalScore : '-'}</td>`;
            
            // Build the table
            container.innerHTML = `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem; min-width: 700px;">
                        <thead>
                            <tr style="background: var(--masters-green); color: var(--masters-gold);">
                                ${holeRow}
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: var(--masters-cream);">
                                ${parRow}
                            </tr>
                            <tr style="background: white;">
                                ${scoreRow}
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center; padding: 10px;">
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <div style="text-align: center;">
                            <span style="font-size: 0.8rem; color: var(--masters-brown);">Gross</span>
                            <div style="font-size: 1.2rem; font-weight: 700; color: var(--masters-dark-green);">${(front9Count + back9Count) > 0 ? totalScore : '-'}</div>
                        </div>
                        <div style="text-align: center;">
                            <span style="font-size: 0.8rem; color: var(--masters-brown);">Net</span>
                            <div style="font-size: 1.2rem; font-weight: 700; color: var(--masters-dark-green);">${(front9Count + back9Count) > 0 ? netScore : '-'}</div>
                        </div>
                        <div style="text-align: center;">
                            <span style="font-size: 0.8rem; color: var(--masters-brown);">To Par</span>
                            <div style="font-size: 1.2rem; font-weight: 700; color: ${totalScore - totalPar < 0 ? '#006747' : totalScore - totalPar > 0 ? '#c00' : 'var(--masters-dark-green)'};">
                                ${(front9Count + back9Count) > 0 ? (totalScore - totalPar === 0 ? 'E' : (totalScore - totalPar > 0 ? '+' : '') + (totalScore - totalPar)) : '-'}
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <span style="font-size: 0.8rem; color: var(--masters-brown);">Thru</span>
                            <div style="font-size: 1.2rem; font-weight: 700; color: ${isFinished ? 'var(--masters-gold)' : 'var(--masters-green)'};">
                                ${isFinished ? 'F' : currentHole}
                            </div>
                        </div>
                    </div>
                    <button onclick="confirmDeleteRound()" class="modal-delete-btn">Delete</button>
                </div>
            `;
        }

        // Update the hole display
        function updateHoleDisplay() {
            const hole = currentRound.currentHole;
            const holeData = courseData.holes[hole];
            const distance = holeData[currentRound.tees];

            document.getElementById('current-hole-number').textContent = `Hole ${hole}`;
            document.getElementById('current-hole-details').textContent = `Par ${holeData.par} ‚Ä¢ SI ${holeData.si}`;
            document.getElementById('current-hole-distance').textContent = `${distance}m`;

            // Update score and putts display
            const holeScore = currentRound.holes[hole];
            document.getElementById('current-score').textContent = holeScore.score !== null ? holeScore.score : '-';
            document.getElementById('current-putts').textContent = holeScore.putts !== null ? holeScore.putts : '-';

            // Update navigation buttons
            document.getElementById('prev-hole-btn').disabled = hole === 1;
            document.getElementById('next-hole-btn').disabled = hole === 18;

            // Update quick nav
            document.querySelectorAll('.quick-nav-btn').forEach((btn, idx) => {
                btn.classList.remove('active');
                const holeNum = idx + 1;
                if (holeNum === hole) btn.classList.add('active');
                if (currentRound.holes[holeNum].score !== null) {
                    btn.classList.add('has-score');
                } else {
                    btn.classList.remove('has-score');
                }
            });

            // Update totals
            updateTotals();
        }

        // Navigate to previous hole
        function prevHole() {
            if (currentRound.currentHole > 1) {
                currentRound.currentHole--;
                updateHoleDisplay();
            }
        }

        // Navigate to next hole
        function nextHole() {
            if (currentRound.currentHole < 18) {
                currentRound.currentHole++;
                updateHoleDisplay();
            }
        }

        // Go to specific hole
        function goToHole(holeNum) {
            currentRound.currentHole = holeNum;
            updateHoleDisplay();
        }

        // Adjust score
        function adjustScore(delta) {
            const hole = currentRound.currentHole;
            const holeData = courseData.holes[hole];
            let currentScore = currentRound.holes[hole].score;

            if (currentScore === null) {
                currentScore = holeData.par; // Default to par
            } else {
                currentScore += delta;
            }

            // Clamp between 1 and 15
            currentScore = Math.max(1, Math.min(15, currentScore));
            currentRound.holes[hole].score = currentScore;
            
            document.getElementById('current-score').textContent = currentScore;
            updateTotals();
            updateQuickNavScored();
            
            // Sync to Firebase
            updateActiveRoundInFirebase();
        }

        // Adjust putts
        function adjustPutts(delta) {
            const hole = currentRound.currentHole;
            let currentPutts = currentRound.holes[hole].putts;

            if (currentPutts === null) {
                currentPutts = 2; // Default to 2 putts
            } else {
                currentPutts += delta;
            }

            // Clamp between 0 and 10
            currentPutts = Math.max(0, Math.min(10, currentPutts));
            currentRound.holes[hole].putts = currentPutts;
            
            document.getElementById('current-putts').textContent = currentPutts;
        }

        // Update quick nav to show which holes have scores
        function updateQuickNavScored() {
            for (let i = 1; i <= 18; i++) {
                const btn = document.getElementById(`quick-nav-${i}`);
                if (btn) {
                    if (currentRound.holes[i].score !== null) {
                        btn.classList.add('has-score');
                    } else {
                        btn.classList.remove('has-score');
                    }
                }
            }
        }

        // Update running totals
        function updateTotals() {
            let front9 = 0, back9 = 0, front9Par = 0, back9Par = 0;
            let front9Count = 0, back9Count = 0;

            for (let i = 1; i <= 9; i++) {
                front9Par += courseData.holes[i].par;
                if (currentRound.holes[i].score !== null) {
                    front9 += currentRound.holes[i].score;
                    front9Count++;
                }
            }
            for (let i = 10; i <= 18; i++) {
                back9Par += courseData.holes[i].par;
                if (currentRound.holes[i].score !== null) {
                    back9 += currentRound.holes[i].score;
                    back9Count++;
                }
            }

            const gross = front9 + back9;
            const net = gross - currentRound.playerHandicap;
            const totalPar = front9Par + back9Par;

            // Format with +/- relative to par
            const formatScore = (score, par, count) => {
                if (count === 0) return '-';
                const diff = score - par;
                const diffStr = diff === 0 ? 'E' : (diff > 0 ? `+${diff}` : diff);
                return `${diffStr} (${score})`;
            };

            document.getElementById('front-9-total').textContent = front9Count > 0 ? formatScore(front9, front9Par, front9Count) : '-';
            document.getElementById('back-9-total').textContent = back9Count > 0 ? formatScore(back9, back9Par, back9Count) : '-';
            
            const totalCount = front9Count + back9Count;
            document.getElementById('gross-total').textContent = totalCount > 0 ? gross : '-';
            document.getElementById('net-total').textContent = totalCount > 0 ? net : '-';
            
            // Update header leaderboard with latest scores
            updateHeaderLeaderboard();
        }

        // Save round to Firestore
        async function saveRound() {
            // Check if any scores entered
            const hasScores = Object.values(currentRound.holes).some(h => h.score !== null);
            if (!hasScores) {
                alert('Please enter at least one hole score before saving.');
                return;
            }

            // Calculate totals
            let totalGross = 0, totalPutts = 0;
            for (let i = 1; i <= 18; i++) {
                if (currentRound.holes[i].score !== null) {
                    totalGross += currentRound.holes[i].score;
                }
                if (currentRound.holes[i].putts !== null) {
                    totalPutts += currentRound.holes[i].putts;
                }
            }
            const totalNet = totalGross - currentRound.playerHandicap;

            // Check if Firestore is available
            if (!window.db || !window.firestoreHelpers) {
                alert('Firebase not initialized. Scores saved locally only.');
                console.log('Round data:', currentRound);
                return;
            }

            try {
                const { doc, setDoc } = window.firestoreHelpers;
                
                // Generate round ID
                const roundId = `${currentRound.playerId}_${currentRound.date}_${Date.now()}`;
                
                const roundData = {
                    tournamentId: 'bonville-2026',
                    playerId: currentRound.playerId,
                    playerName: currentRound.playerName,
                    date: currentRound.date,
                    tees: currentRound.tees,
                    holes: currentRound.holes,
                    totalGross: totalGross,
                    totalNet: totalNet,
                    totalPutts: totalPutts,
                    status: 'completed',
                    lastUpdated: new Date().toISOString()
                };

                await setDoc(doc(window.db, 'rounds', roundId), roundData);
                
                // Mark as finished in active rounds (don't remove - keep visible on leaderboard)
                await markRoundAsFinishedInFirebase();
                
                alert('Round saved successfully!');
                fireConfetti();
                
                // Update the header leaderboard to show finished status
                updateHeaderLeaderboard();
                
                // Clear current round locally
                currentRound = null;
                
                // Return to setup
                document.getElementById('round-setup').style.display = 'block';
                document.getElementById('score-entry').style.display = 'none';

            } catch (error) {
                console.error('Error saving round:', error);
                alert('Error saving round. Please try again.');
            }
        }

        // Check for active rounds from today and show header leaderboard
        async function checkForTodaysActiveRounds() {
            if (!window.db || !window.firestoreHelpers) {
                console.log('Firebase not initialized, retrying in 1 second...');
                setTimeout(checkForTodaysActiveRounds, 1000);
                return;
            }
            
            try {
                const { collection, getDocs } = window.firestoreHelpers;
                const snapshot = await getDocs(collection(window.db, 'activeRounds'));
                
                console.log('Active rounds found:', snapshot.size);
                
                const now = new Date();
                const twentyFourHoursAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);
                
                let hasRecentRounds = false;
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    console.log('Round data:', data.playerName, data.startedAt);
                    if (data.startedAt) {
                        const startedAt = new Date(data.startedAt);
                        if (startedAt >= twentyFourHoursAgo) {
                            hasRecentRounds = true;
                        }
                    } else {
                        // If no startedAt, assume it's recent
                        hasRecentRounds = true;
                    }
                });
                
                if (hasRecentRounds) {
                    console.log('Found active rounds, showing header leaderboard');
                    showHeaderLeaderboard();
                }
            } catch (error) {
                console.error('Error checking for active rounds:', error);
            }
        }
        
        // Initialize dropdowns and leaderboard when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializePlayerDropdowns();
            initializeLeaderboard();
            initializeLiveScoresPlayers();
            
            // Check for today's active rounds - wait for Firebase to be ready
            waitForFirebaseAndCheckRounds();
        });
        
        // Wait for Firebase to initialize then check for active rounds
        function waitForFirebaseAndCheckRounds() {
            if (window.db && window.firestoreHelpers) {
                console.log('Firebase ready, checking for active rounds...');
                checkForTodaysActiveRounds();
            } else {
                console.log('Waiting for Firebase to initialize...');
                setTimeout(waitForFirebaseAndCheckRounds, 500);
            }
        }

        // Day 2 Individual Leaderboard Calculator
        const players = [
            { id: 1, name: 'Mike Buller', handicap: 12 },
            { id: 2, name: 'David Thompson', handicap: 8 },
            { id: 3, name: 'Michael Roberts', handicap: 15 },
            { id: 4, name: 'Chris Anderson', handicap: 10 },
            { id: 5, name: 'Ryan Campbell', handicap: 6 },
            { id: 6, name: 'Andrew Wilson', handicap: 14 },
            { id: 7, name: 'Steven Parker', handicap: 11 },
            { id: 8, name: 'Daniel Hughes', handicap: 9 }
        ];

        function calculateLeaderboard() {
            const results = players.map(player => {
                const gross = parseInt(document.getElementById('score' + player.id).value) || 0;
                const net = gross > 0 ? gross - player.handicap : 0;
                return { ...player, gross, net };
            }).filter(p => p.gross > 0);

            // Sort by net score (lowest first)
            results.sort((a, b) => a.net - b.net);

            const leaderboardBody = document.getElementById('leaderboard-body');
            leaderboardBody.innerHTML = '';

            for (let i = 0; i < 8; i++) {
                const player = results[i];
                const positionClass = i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : '';
                const rowClass = i === 0 ? 'first' : '';
                
                if (player) {
                    leaderboardBody.innerHTML += `
                        <div class="leaderboard-row ${rowClass}">
                            <span class="position ${positionClass}">${i + 1}</span>
                            <span>${player.name}</span>
                            <span>${player.gross}</span>
                            <span>${player.net}</span>
                        </div>
                    `;
                    
                    // Highlight winner card
                    document.querySelectorAll('.player-battle-card').forEach(card => {
                        card.classList.remove('champion');
                        if (i === 0 && card.dataset.player == player.id) {
                            card.classList.add('champion');
                        }
                    });
                } else {
                    leaderboardBody.innerHTML += `
                        <div class="leaderboard-row">
                            <span class="position">${i + 1}</span>
                            <span>-</span>
                            <span>-</span>
                            <span>-</span>
                        </div>
                    `;
                }
            }
        }
    </script>
</body>
</html>
